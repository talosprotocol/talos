name: License Compliance
permissions: read-all

on:
  workflow_dispatch: # Manual trigger only - scripts not yet implemented
  # push:
  #   branches: [main, master]
  # pull_request:
  #   branches: [main, master]

jobs:
  license-compliance:
    name: License Compliance Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive
          token: ${{ secrets.SUBMODULE_SYNC_TOKEN || secrets.GITHUB_TOKEN }}

      - name: Validate Manifest
        continue-on-error: true
        run: |
          if [ -f "scripts/generate_repos_manifest.sh" ]; then
            chmod +x scripts/generate_repos_manifest.sh
            ./scripts/generate_repos_manifest.sh
          else
            echo "generate_repos_manifest.sh not found, skipping"
          fi

      - name: Provenance Scan
        continue-on-error: true
        run: |
          if [ -f "scripts/provenance_scan.sh" ]; then
            chmod +x scripts/provenance_scan.sh
            ./scripts/provenance_scan.sh
          else
            echo "Provenance scan script not found, skipping"
          fi

      - name: Verify Licenses
        continue-on-error: true
        run: |
          if [ -f "scripts/verify_licenses.sh" ]; then
            chmod +x scripts/verify_licenses.sh
            ./scripts/verify_licenses.sh
          else
            echo "License verification script not found, skipping"
          fi
